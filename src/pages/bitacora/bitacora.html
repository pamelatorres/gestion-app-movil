<!--
  Generated template for the BitacoraPage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header>

  <ion-navbar color="primary">
    <button ion-button menuToggle>
      <ion-icon name="menu"></ion-icon>
    </button>
    <ion-title>{{bitacora.nombre_clasificacion}}</ion-title>
  </ion-navbar>

</ion-header>


<ion-content padding class="page-bitacora" [style.background-color]="bitacora.color_alerta">
  <ion-card>
<!--     <img src="img/nin-live.png"/>-->    
    <ion-card-content style="padding:7px;">
      <ion-card-title class="res-title">
        <h2 text-center><b>{{bitacora.nombre_responsabilidad}}</b></h2>
        <h3 *ngIf="this.bitacora.titulo != null">
          <b>{{(this.bitacora.titulo | truncate: 15) + (this.bitacora.titulo.length > 15 ? '...' : '')}}</b>
        </h3>
      </ion-card-title>
      <p *ngIf="this.bitacora.observacion != null">
        {{(this.bitacora.observacion | truncate: 140) + (this.bitacora.observacion.length > 140 ? '...' : '')}}
      </p>
    </ion-card-content>
  </ion-card>
  <ion-card>
<<<<<<< HEAD
   <ion-fab right edge class="expand-fab" (click)="desplegarLista(1)">
     <button ion-fab mini>
       <ion-icon [name]="iconoLista1"></ion-icon>
     </button>
   </ion-fab>
    <ion-card-header class="ion-card-header">
      <ion-item text-uppercase text-wrap no-padding class="res-list">
        <p>
          <ion-icon (click)="abrirToast('Responsable principal')" name="person"></ion-icon>
          <b> Responsable principal</b>
          <br>
          <i margin-left>{{responsablePrincipal}}</i>
        </p>
      </ion-item>
    </ion-card-header>
    <ion-card-content *ngIf="verLista1" no-margin>
      <ion-list class="res-list">
        <ion-item text-uppercase text-wrap no-padding item-left>
          <p>
          <ion-icon (click)="abrirToast('Departamento responsable')" name="home"></ion-icon>
          <b> Departamento</b>
          <br>
          <i margin-left>{{bitacora.nombre_depto}}</i>
=======
    <ion-card-header>
      <ion-item text-uppercase text-wrap no-padding item-left>
        <p>
        <ion-icon (click)="abrirToast('Departamento responsable')" name="home"></ion-icon>
        <b> Departamento</b>
        <br>
        <i margin-left>{{bitacora.nombre_depto}}</i>
        </p>
      </ion-item>
      <button ion-button icon-only item-right float-right (click)="desplegarLista(1)">
        <ion-icon [name]="iconoLista1"></ion-icon>
      </button>
    </ion-card-header>
    <ion-card-content *ngIf="verLista1" no-margin>
      <ion-list class="res-list">

        <ion-item text-uppercase text-wrap no-padding>
          <p>
            <ion-icon (click)="abrirToast('Responsable principal')" name="person"></ion-icon>
            <b> Responsable principal</b>
            <br>
            <i margin-left>{{responsablePrincipal}}</i>
>>>>>>> master
          </p>
        </ion-item>
        <ion-item text-uppercase text-wrap no-padding>
          <p>
            <ion-icon name="calendar"></ion-icon>
            <b> Fecha de inicio</b>
            <br>
            <i margin-left>{{this.bitacora.fecha_creacion | date: 'd'}} de {{this.bitacora.fecha_creacion | date: 'MMMM'}} del {{this.bitacora.fecha_creacion | date: 'y'}} a las {{this.bitacora.fecha_creacion | date: 'H:m'}}</i>
          </p>
        </ion-item>
        <ion-item text-uppercase text-wrap no-padding>
          <p>
            <ion-icon name="alert"></ion-icon>
            <b> Nivel de alerta</b>
            <br>
            <i margin-left>{{bitacora.nombre_nivel}}</i>
          </p>
        </ion-item>
        <ion-item text-uppercase text-wrap no-padding>
          <p>
            <ion-icon name="navigate"></ion-icon>
            <b> Estado</b>
            <br>
            <i margin-left>{{bitacora.nombre_estado}}</i>
          </p>
        </ion-item>
      </ion-list>      
    </ion-card-content>
  </ion-card>

  <ion-card>
<<<<<<< HEAD
    <ion-fab right edge class="expand-fab" (click)="desplegarLista(2)">
      <button ion-fab mini>
        <ion-icon [name]="iconoLista2"></ion-icon>
      </button>
    </ion-fab>
    <ion-card-header class="ion-card-header">
      <ion-item text-uppercase no-padding text-wrap class="res-list">
        <p>
          <ion-icon name="person"></ion-icon>
          <b> Responsable actual</b>
          <br>
          <i margin-left>{{responsableActual}}</i>
        </p>
      </ion-item>
    </ion-card-header>
    <ion-card-content *ngIf="verLista2">
      <ion-list class="res-list">
=======
    <ion-card-header>
      <button ion-button icon-only item-right float-right (click)="desplegarLista(2)">
        <ion-icon [name]="iconoLista2"></ion-icon>
      </button>
    </ion-card-header>
    <ion-card-content *ngIf="verLista2">
      <ion-list class="res-list">
        <ion-item text-uppercase no-padding text-wrap>
          <p>
            <ion-icon name="person"></ion-icon>
            <b> Responsable actual</b>
            <br>
            <i margin-left>{{responsableActual}}</i>
          </p>
        </ion-item>
>>>>>>> master
        <ion-item text-uppercase text-wrap no-padding>
          <p>
            <ion-icon name="calendar"></ion-icon>
            <b> Fecha de inicio</b>
            <br>
            <i margin-left>{{this.bitacora.fecha_creacion | date: 'd'}} de {{fechaActual | date: 'MMMM'}} del {{fechaActual | date: 'y'}} a las {{fechaActual | date: 'H:m'}}</i>
          </p>
        </ion-item>
        <ion-item text-uppercase text-wrap no-padding>
          <p>
            <ion-icon (click)="abrirToast('Departamento responsable')" name="home"></ion-icon>
            <b> Departamento</b>
            <br>
            <i margin-left>{{departamentoActual}}</i>
          </p>
        </ion-item>
      </ion-list>
    </ion-card-content>  
  </ion-card>
  <ion-card>
    <ion-card-content>
      <button ion-item no-padding text-uppercase text-wrap (click)="verProtocolo()">
        <ion-icon name="archive" item-start></ion-icon>
        <b>Ver protocolo</b>
      </button>
      <button ion-item no-padding text-uppercase text-wrap (click)="irA('DocumentacionPage')">
        <ion-icon name="document" item-start></ion-icon>
        <b>Documentar bitácora</b>
      </button>
      <button ion-item no-padding text-uppercase text-wrap (click)="abrirDetalle()">
        <ion-icon name="document" item-start></ion-icon>
        <b>Resumen solución bitácora</b>
      </button>
      <button ion-item no-padding text-uppercase text-wrap (click)="irA('BitacoraMapaPage')">
        <ion-icon name="map" item-start></ion-icon>
        <b>Ver incidente en mapa</b>
      </button>
    </ion-card-content>  
  </ion-card>
  <ion-card>

    <ion-card-header *ngIf="this.bitacora.observacion == null">
      <button (click)="irADetallarBitacora()" ion-button round full>Describir bitácora</button>
    </ion-card-header>

    <ion-card-content>
      <ion-list>
        <button ion-item no-padding text-uppercase text-wrap *ngIf="calculoDiasData.length > 1" (click)="toggleGroup(7)" [ngClass]="{active: isGroupShown(7)}">
          <ion-icon name="arrow-round-forward" item-start></ion-icon>
          <b>Derivaciones</b>
          <ion-badge item-end>{{calculoDiasData.length -1}}</ion-badge>
        </button>

        <div *ngIf="isGroupShown(7)">
          <ion-item text-wrap text-justify no-padding *ngFor="let dias of  calculoDiasData;">
            <p item-center><b>Responsable <br> {{dias.responsable}}</b></p>
            <p item-center><i>Departamento <br>{{dias.depto_responsable}}</i></p>
            <p item-center><i>Inicio {{dias.finicio_responsable}}</i></p>
            <p item-center *ngIf="dias.ftermino_responsable"><i>Termino {{dias.ftermino_responsable}}</i></p>
            <p item-center><i>Estado {{dias.bestado_responsable}}</i></p>
            <p item-center><i>Días {{dias.dias_responsable_1}}</i></p>
          </ion-item>
        </div>

        <button ion-item no-padding text-uppercase text-wrap *ngIf="tareas.length > 0" (click)="toggleGroup(6)" [ngClass]="{active: isGroupShown(6)}">
          <ion-icon name="list" item-start></ion-icon>
          <b>Tareas</b>
          <ion-badge item-end>{{tareasPendientes}}</ion-badge>
        </button>

        <div *ngIf="isGroupShown(6)">
          <ion-item text-wrap no-padding text-justify *ngFor="let tarea of tareas;">
            <p item-center>Detalle: {{tarea.detalle_tarea}}</p>
            <p item-center>Fecha incio: {{tarea.fecha_inicio_tarea}}</p>
            <p item-center>Fecha termino: {{tarea.fecha_termino_tarea}}</p>
            <p item-center *ngIf="tarea.estado_tarea == 1">
              En proceso
            </p>
            <p item-center *ngIf="tarea.estado_tarea == 0">
              {{tarea.realizacion_tarea == '1' ? 'Tarea realizada':'Tarea no realizada'}}
            </p>
            <p item-center *ngIf="tarea.estado_tarea == 0"> 
              {{tarea.respuesta_tarea}}
            </p>
          </ion-item>
        </div>

        <button ion-item no-padding text-wrap text-uppercase *ngIf="vbs.length > 0" (click)="toggleGroup(5)" [ngClass]="{active: isGroupShown(5)}">
          <ion-icon name="checkmark" item-start></ion-icon>
          <b>Vistos buenos</b>
          <ion-badge item-end>{{vbsPendientes}}</ion-badge>
        </button>

        <div *ngIf="isGroupShown(5)">
          <ion-item text-wrap no-padding text-justify *ngFor="let visto of vbs;">
            <p item-center>Detalle <br>{{visto.detalle_vb}}</p>
            <p item-center *ngIf="visto.aprueba_vb">{{visto.aprueba_vb == 1 ? 'Aprobado' : 'Rechazado'}}</p>
            <p *ngIf="visto.monto_vb > 0" item-center>Monto ${{visto.monto_vb}}</p>
            <p item-center>{{visto.fecha_ingreso_vb}}</p>
          </ion-item>
        </div>
      </ion-list>

      <button ion-item no-padding text-wrap text-uppercase (click)="irA('AgendaPage')" *ngIf="agendasPendientes > 0">
        <ion-icon name="bookmark" item-start></ion-icon>
        <b>Agendas</b>
        <ion-badge item-end>{{agendasPendientes}}</ion-badge>
      </button>
    </ion-card-content>
  
  </ion-card>
  <ion-fab right top>
    <button (click)="abrirToast('Número de días transcurridos')" ion-fab color="danger"><b>{{+diasTotales -1}} </b> &nbsp;{{+diasTotales -1 == 1 ? 'Día':'Días'}}</button>
  </ion-fab>
  <ion-fab right bottom>
    <button *ngIf="evaluacion != null" (click)="irAEvaluacion()" ion-fab color="secondary"><ion-icon md-name="date_range"></ion-icon></button>
    <button *ngIf="evaluacion == null" [disabled]="this.bitacora.nombre_estado == 'Derivado' || tipo_accion || !responsable" (click)="irACrearBitacora()" ion-fab color="primary"><ion-icon name="add"></ion-icon></button>
  </ion-fab>
</ion-content>